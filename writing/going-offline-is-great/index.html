<!doctype html><html lang=en-us class=no-js><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Marc Friederich"><meta name=twitter:card content="summary"><meta name=twitter:domain content="https://zufrieden.io/"><meta name=twitter:image content="https://zufrieden.io/tn.png"><meta name=twitter:title property="og:title" itemprop="title name" content="zufrieden.io/"><meta name=twitter:description property="og:description" itemprop=description content="Marc Friederich"><meta name=og:type content="website"><meta name=og:url content="https://zufrieden.io/"><meta name=og:image itemprop="image primaryImageOfPage" content="https://zufrieden.io/tn.png"><title>Going offline is so great</title><link rel=manifest href=/manifest.json><link rel=stylesheet href=/css/style.css?20221030-0003><link rel=authorization_endpoint href=https://indieauth.com/auth><script>if(navigator.serviceWorker){window.addEventListener('load',function(){navigator.serviceWorker.register('/zufrieden-sw.js',{scope:'/'});if(navigator.serviceWorker.controller){navigator.serviceWorker.controller.postMessage({'command':'trimCaches'});}});}</script><script>document.documentElement.className=document.documentElement.className.replace("no-js","js");</script></head><body><nav class=a11y-navigation aria-label="Accessibility navigation"><ul><li><a class="sr-only sr-show-on-focus" accesskey=0 href=/ title="[Alt+0] Homepage">Homepage</a></li><li><a class="sr-only sr-show-on-focus" accesskey=1 href=#menu title="[Alt+1] Website Navigation">Website Navigation</a></li><li><a class="sr-only sr-show-on-focus" accesskey=2 href=#main title="[Alt+2] Skip to content">Skip to content</a></li></ul></nav><header><nav role=menubar id=menu><ul><li class=home><a href=https://zufrieden.io/>zufrieden.io/</a></li><li><a href=/writing>Writing</a></li><li><a href=/linking>Linking</a></li><li><a href=/talking>Talking</a></li><li><a href=/making-pictures>Making pictures</a></li><li><a href=/about>About</a></li></ul></nav></header><main class=container><h1>Going offline is so great</h1><h2>How I added a service worker on this website</h2><section><h3>Jan 03, 2021 &#183; 428 words<ul class=tags><li class=tag><a href=https://zufrieden.io/tags/blog>blog</a></li><li class=tag><a href=https://zufrieden.io/tags/dev>dev</a></li></ul></h3></section><section><h2 id=you-might-be-offline-check-your--mode>You might be offline, check your ‚úàÔ∏è mode.</h2><p>You would see this page if my website is offline, or you are disconnected from the network, or you just click to see this article.</p><h2 id=service-workers-should-be-implemented-based-on-the-website-strategy>Service Workers should be implemented based on the website strategy</h2><p>I heard about Service Workers and PWA a few years ago. I really am appealed by this kind of technology. Simple, resilient, not relying on framework or 4 abstraction levels. After reading <a href=https://abookapart.com/products/going-offline>Going Offline book</a> from Jeremy Keith more than a year ago I wanted to implement an offline strategy on my website. You could argue that your framework, CMS or generator implement service worker for you, so you don&rsquo;t have to worry. Wrong! You should consider your users and their cache capacity by adapting your service worker strategy according to it.</p><h2 id=here-is-my-strategy-for-zufriedenio>Here is my strategy for zufrieden.io</h2><p>I value your local memory, so I decided to cache 1 file of CSS, 2 fonts and this about offline mode article. The rest of the caching strategy is around your visit. Each page you load (up to 40 pages, 50 images), will be cached for 5 minutes. When the server is not in reach, you will have the page you requested. If not available in your cache, I will give you this article.</p><h2 id=how-its-made>how it&rsquo;s made</h2><p>The full file is available here <a href=/zufrieden-sw.js>/zufrieden-sw.js</a> for you to see. This code is a shameless copy from <a href=https://adactio.com/serviceworker.js>adacio.com</a>. Code explained on the book and also available with steps on <a href=https://github.com/adactio/goingofflinecode>github/adacio/goingofflinecode</a>.</p><p>In the <code>&lt;head></code> First register the service worker</p><div class=highlight><pre style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JS data-lang=JS><span style=color:#776e71>// Register our service-worker
</span><span style=color:#776e71></span><span style=color:#815ba4>if</span> (<span style=color:#06b6ef>navigator</span>.<span style=color:#06b6ef>serviceWorker</span>) {
	window.<span style=color:#06b6ef>addEventListener</span>(<span style=color:#48b685>&#39;load&#39;</span>, <span style=color:#815ba4>function</span>() {
		<span style=color:#06b6ef>navigator</span>.<span style=color:#06b6ef>serviceWorker</span>.<span style=color:#06b6ef>register</span>(<span style=color:#48b685>&#39;/zufrieden-sw.js&#39;</span>, {
			<span style=color:#06b6ef>scope</span><span style=color:#5bc4bf>:</span> <span style=color:#48b685>&#39;/&#39;</span>
		});
	});
}
</code></pre></div><h2 id=listening-native-events-install-activate-fetch>Listening native events <code>install</code>, <code>activate</code>, <code>fetch</code>.</h2><p>Service worker is not altering the page first display performance as there is no relation with the DOM or the current page rendering. It will be installed, perform install event (caching CSS, fonts and this page then the current page).</p><div class=highlight><pre style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#06b6ef>addEventListener</span>(<span style=color:#48b685>&#39;fetch&#39;</span>, <span style=color:#815ba4>function</span> (<span style=color:#06b6ef>event</span>) {
  <span style=color:#06b6ef>console</span>.<span style=color:#06b6ef>log</span>(<span style=color:#48b685>&#39;The service worker is listening.&#39;</span>);
});

<span style=color:#06b6ef>addEventListener</span>(<span style=color:#48b685>&#39;install&#39;</span>, <span style=color:#815ba4>function</span> (<span style=color:#06b6ef>event</span>) {
  <span style=color:#06b6ef>console</span>.<span style=color:#06b6ef>log</span>(<span style=color:#48b685>&#39;The service worker is installing . . . &#39;</span>);
});

<span style=color:#06b6ef>addEventListener</span>(<span style=color:#48b685>&#39;activate&#39;</span>, <span style=color:#815ba4>function</span> (<span style=color:#06b6ef>event</span>) {
  <span style=color:#06b6ef>console</span>.<span style=color:#06b6ef>log</span>(<span style=color:#48b685>&#39;The service worker is activated.&#39;</span>);
});
</code></pre></div><h2 id=offline-only-website-why-not>Offline only website, why not</h2><p>More offline project to discover : <a href=https://thedisconnect.co>The Disconnect</a> is a great exemple of playing with service worker strategy.</p><h2 id=still-offline-check-my-love-letter-to-the-web>Still offline, check my love letter to the web</h2><p>Building a more resilient web, understanding the value of the web and how we build a more sustainable heritage. I consider myself a web dinosaur, let&rsquo;s not condemn ourself to quickly to extinction. <a href=/writing/a-love-letter-to-the-web/>Read my article about why I love the web</a></p></section></main><footer class=footer><div class=footer_links><ul class="list-icons list-icons-center"><li><h2>üì®</h2><a href=mailto:m@zufrieden.io>m@zufrieden.io</a></li><li><h2>üôä</h2><a data-hint=Twitter title=Twitter href=https://twitter.com/zufrieden target=_blank rel=me>twitter.com/zufrieden</a></li><li><h2>üêô</h2><a data-hint=Github title=Github href=https://github.com/zufrieden target=_blank rel=me>github.com/zufrieden</a></li></ul></div></footer></body><script>function gethue(){const x=1-(window.innerWidth)/10000;const actual_color_hue=getComputedStyle(document.documentElement).getPropertyValue('--color-h');document.documentElement.style.setProperty('--color-h',Math.round(300*x));}
gethue();window.addEventListener('resize',()=>{gethue();})</script></html>